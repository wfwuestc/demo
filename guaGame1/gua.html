<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>game1</title>
  <style>
    #id-canvas {
      border: 1px solid;
    }
  </style>
  <script src="js/game.js"></script>
  <script src="js/ball.js"></script>
  <script src="js/paddle.js"></script>
  <script src="js/block.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/level.js"></script>
</head>
<body>
  <canvas id="id-canvas" width="400" height="300"></canvas>
<script>
var loadLevel = function (n) {
    n = n - 1
    var level = levels[n]
    var blocks = []
    for (var i = 0; i < level.length; i++) {
        var p = level[i]
        var b = Block(p)
        blocks.push(b)
    }
    return blocks
  }
  var blocks = []
  var __main = function () {
    var game = guaGame(30)

    var paddle = Paddle()
    var ball = Ball()

    blocks = loadLevel(1)

    game.registerAction('a', function () {
      paddle.moveLeft()
    })
    game.registerAction('d', function () {
      paddle.moveRight()
    })
    game.registerAction('f', function () {
      ball.fire()
    })
    var paused = false
    window.addEventListener('keydown',function (event) {
      log(event.key)
      if (event.key == 'p'){
        paused = !paused
      } else if (event.key == '1') {
        loadLevel(1)
      } else if (event.key == '2') {
        loadLevel(2)
      }
    })
    game.update = function () {
      if (paused){
        return
      }
      ball.move()
      //判断相撞
      for (var j = 0; j < 3; j++){
        var block = blocks[j]
        //判断ball和block相撞
        if(block.collide(ball)){
          log(1)
          block.kill()
          ball.bounce()
        }
      }
      if (paddle.collide(ball)){
        ball.bounce()
      }

    }

    // event
    game.draw = function () {
      game.drawImage(paddle)
      game.drawImage(ball)
      for (var i = 0; i < 3; i++){
        var block = blocks[i]
        if (block.alive){
          game.drawImage(block)
        }
      }
    }



  }

  __main()

</script>
</body>
</html>